webpackJsonp([2],{137:function(t,e,i){var n,s;i(219),n=i(152);var o=i(203);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=o.render,s.staticRenderFns=o.staticRenderFns,t.exports=n},152:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(192),o=n(s),r=i(191),a=n(r);e.default={components:{navigation:o.default,sidebar:a.default}}},167:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={}},168:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},o=i(189),r=n(o),a=i(39);e.default={data:function(){return{statusList:[{value:"idle",icon:"status_online",label:"空闲"},{value:"busy",icon:"status_busy",label:"忙碌"},{value:"away",icon:"status_offline",label:"离席"}],status:"busy",extensionStatus:"offline",extensionClientRes:"",origin:{user:{}},time:""}},computed:s({},(0,a.mapGetters)(["callLogCurrentList"]),{currentCall:function(){return this.callLogCurrentList[0]?this.callLogCurrentList[0]:{}}}),methods:s({},(0,a.mapActions)(["getCurrentList"]),{logout:function(){var t=this;this.$http.get("user/logout").then(function(e){return e.success?(alert("登出成功"),void t.$router.push({name:"logout"})):void alert(e.message)})},answer:function(){return"ringing"===this.currentCall.status&&(this.client.answer(),this.updateRecord("confirmed")),!1},hangup:function(){var t=this.currentCall.status;return"confirmed"!==t&&"ringing"!==t||(this.client.hangup(),this.updateRecord("disconnected")),!1},setAccount:function(){var t=this.origin.user.extension_detail;this.client.setAccount(t.user,t.password,t.domain,t.timeout)},transformRecord:function(t){var e=t.params.call.localUri.split(":")[1].split("@")[0],i=t.params.call.remoteUri.split(":")[1].split("@")[0],n=i,s=t.params.call.status,o=1;return{fromnum:i,tonum:e,client_num:n,status:s,type:o}},updateRecord:function(t){var e=this,i={status:t};this.$http.post("user/calllog/edit/"+this.currentCall.id,i).then(function(t){e.getCurrentList()})},judgeRecord:function(t){var e=this,i=this.transformRecord(t);"ringing"===i.status&&(console.log("add, ringing",i),this.$http.post("user/calllog/add",i).then(function(t){e.getCurrentList(),"current-detail"!==e.$route.params.name&&e.$router.push({name:"admin"})})),"confirmed"===i.status&&(this.updateRecord("confirmed"),this.timego()),"disconnected"===i.status&&(this.updateRecord("disconnected"),this.clearTime())},updateExtensionStatus:function(t){t.params.account?this.extensionStatus="online":this.extensionStatus="close"},getUserInfo:function(){var t=this;this.$http.get("user/info").then(function(e){e.success&&(t.origin.user=e.data.user,t.status=e.data.user.status,t.reconnect())})},changeUserStatus:function(){this.$http.post("user/status",{status:this.status}).then(function(t){})},timego:function(){var t=this,e=(new Date).getTime();this.timeInterval=setInterval(function(){t.time=parseInt(((new Date).getTime()-e)/1e3)},1e3)},clearTime:function(){clearInterval(this.timeInterval),this.time=0},reconnect:function(){var t=this,e=void 0,i="production";e="production"===i?new r.default("ws://localhost:8430/"):new r.default("ws://192.168.10.75:8430/"),e.ws.onopen=function(){console.log(".. connection open"),t.setAccount()},e.ws.onmessage=function(e){var i=JSON.parse(e.data);"onCallState"===i.method&&t.judgeRecord(i),"onRegState"===i.method&&t.updateExtensionStatus(i),"setAccount"===i.id&&null===i.result&&(t.extensionStatus="online")},e.ws.onclose=function(){console.log(".. connection closed"),this.extensionStatus="close",setTimeout(function(){return t.reconnect()},3e3)},this.client=e,0===e.ws.readyState&&(console.log(".. connection pending"),this.extensionStatus="close")}}),mounted:function(){this.getUserInfo()}}},173:function(t,e,i){e=t.exports=i(15)(),e.push([t.i,".el-select-dropdown__item.selected,.el-select-dropdown__item.selected.hover{background:#e5e9f2}#header{background:linear-gradient(180deg,#fefeff,#e9f3fc);position:fixed;z-index:999;left:0;right:0;top:0;bottom:0;height:80px;min-width:1180px;border-bottom:1px inset #c5d5e4}#header .el-select{width:70px}#current-zuoxi{color:#333;font-size:12px;display:inline-block;padding:20px;float:right}#current-zuoxi .fenji{margin-bottom:5px}.user-zuoxi-status svg{width:12px;height:12px}#status_offline{fill:gray}#status_busy{fill:#ff2d86}#status_online{fill:#45c8dc}#website-logo{display:inline-block;height:80px;width:100px;background:#41475f}#website-logo img{width:48px;height:37px}.current-phone{display:inline-block;vertical-align:baseline}.phone-operator{display:inline-block;margin:0}.phone-operator svg{margin-bottom:5px;fill:#41475f}.phone-operator li{color:#c0c6df;height:63px;width:58px;text-align:center;display:inline-block;margin:0;border-radius:4px;cursor:pointer}.phone-operator li svg{fill:#c0c6df}.phone-operator li.is-active-answer,.phone-operator li.is-active-hangup{color:#333}.phone-operator li.is-active-answer svg{fill:#45c8dc}.phone-operator li.is-active-hangup svg{fill:#ff2d86}.phone-operator li:hover{background:#fff}.phone-status-box{width:240px;height:64px;display:inline-block;background:#98a2cc;border-radius:3px;color:#fff;padding:10px}.phone-status-box .phone-number{color:#f8ff37}",""])},177:function(t,e,i){e=t.exports=i(15)(),e.push([t.i,"#main{margin:90px 0 0 110px}",""])},178:function(t,e,i){e=t.exports=i(15)(),e.push([t.i,'#aside{width:100px;color:#fff;background:#4f556e;position:fixed;top:80px;left:0;bottom:0;right:0}#aside .aside-link-wrap{width:100%;height:100%}#aside svg{margin-bottom:12px;fill:#fff}#aside ul{margin:0}#aside ul li{display:list-item;text-align:center;margin:0;height:80px}#aside ul li a{color:#fff;display:inline-block;text-decoration:none;padding:18px 0;width:100%;height:100%}#aside ul li a.router-link-active{background:#454b64;position:relative}#aside ul li a.router-link-active:before{position:absolute;left:0;top:0;bottom:0;right:0;content:"";display:inline-block;border-left:3px solid #f8ff37}',""])},187:function(t,e,i){t.exports=i.p+"logo.png?24d50765815ed2022246394d74a6bb6d"},189:function(t,e,i){/*!
 * oneyun-client-js v0.1.4
 * https://github.com/liushuixingyun/oneyun-server-api-nodejs
 * Released under the MIT License.
 */
!function(e,i){t.exports=i()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function e(i){t(this,e),this.sipAddr=i,this._createWS(this.sipAddr)}return e.prototype._createWS=function(t){var e=window.WebSocket||window.MozWebSocket;this.ws=new e(t)},e.prototype._send=function(t,e){this.ws.send(JSON.stringify({method:t,params:e?[].concat(e):[],id:t}))},e.prototype.getAccount=function(){this._send("getAccount")},e.prototype.answer=function(){this._send("answer")},e.prototype.show=function(){this._send("show")},e.prototype.hide=function(){this._send("hide")},e.prototype.hangup=function(){this._send("hangup")},e.prototype.getCurrentVolume=function(){this._send("getCurrentVolume")},e.prototype.getCurrentMicroVolume=function(){this._send("getCurrentMicroVolume")},e.prototype.setVolume=function(t){this._send("setVolume",t)},e.prototype.setMicroVolume=function(t){this._send("setMicroVolume",t)},e.prototype.minimize=function(){this._send("minimize")},e.prototype.show=function(){this._send("show")},e.prototype.setAccount=function(t,e,i,n){var s=[t,e,i,n];this._send("setAccount",s)},e}();return e})},191:function(t,e,i){var n,s;i(220),n=i(167);var o=i(205);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=o.render,s.staticRenderFns=o.staticRenderFns,t.exports=n},192:function(t,e,i){var n,s;i(215),n=i(168);var o=i(198);s=n=n||{},"object"!=typeof n.default&&"function"!=typeof n.default||(s=n=n.default),"function"==typeof s&&(s=s.options),s.render=o.render,s.staticRenderFns=o.staticRenderFns,t.exports=n},198:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"bg-gray",attrs:{id:"header"}},[t._m(0),t._v(" "),i("div",{staticClass:"current-phone"},[i("div",{staticClass:"phone-operator icons"},[i("ul",[i("li",{class:{"is-active-answer":"ringing"===t.currentCall.status},on:{click:t.answer}},[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#answer"}})])]),t._v(" "),i("div",[t._v("接听")])])]),t._v(" "),i("li",{class:{"is-active-hangup":"confirmed"===t.currentCall.status||"ringing"===t.currentCall.status},on:{click:t.hangup}},[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#hangup"}})])]),t._v(" "),i("div",[t._v("挂机")])])]),t._v(" "),i("li",[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#callout"}})])]),t._v(" "),i("div",[t._v("外呼")])])]),t._v(" "),i("li",[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#keep"}})])]),t._v(" "),i("div",[t._v("保持")])])]),t._v(" "),i("li",[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#keepback"}})])]),t._v(" "),i("div",[t._v("保持找回")])])]),t._v(" "),i("li",[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#multiple"}})])]),t._v(" "),i("div",[t._v("多方")])])]),t._v(" "),i("li",[i("div",{staticClass:"fill flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#transfer"}})])]),t._v(" "),i("div",[t._v("转移")])])])])]),t._v(" "),i("div",{staticClass:"phone-status-box"},[!t.currentCall||"confirmed"!==t.currentCall.status&&"ringing"!==t.currentCall.status?i("div",{},[i("div",{staticClass:"flex-1"},[t._v("\n              当前无通话\n            ")]),t._v(" "),i("div",{staticClass:"flex-1 flex direction-row"},[i("div",{staticClass:"flex "})])]):i("div",{staticClass:"flex direction-column"},[i("div",{staticClass:"flex-1 phone-number"},[t._v("\n              "+t._s(t.currentCall.fromnum)+"\n            ")]),t._v(" "),i("div",{staticClass:"flex-1 flex direction-row"},[i("div",{staticClass:"flex"},["confirmed"===t.currentCall.status?i("span",[t._v("正在通话")]):t._e(),t._v(" "),"ringing"===t.currentCall.status?i("span",[t._v("等待接听")]):t._e()]),t._v(" "),""!==t.time?i("div",{staticClass:"flex flex-1 h-end"},[t._v(t._s(t.time)+" 秒")]):i("div",{staticClass:"flex flex-1 h-end"})])])])]),t._v(" "),i("div",{attrs:{id:"current-zuoxi"}},[i("div",{staticClass:"fr fenji"},[t._v("\n        分机号: "),i("span",{staticClass:"text-danger"},[t._v(t._s(this.origin.user.extension))]),t._v(" "),"online"===this.extensionStatus?i("span",[t._v(" (已就绪)")]):t._e(),t._v(" "),"pending"===this.extensionStatus?i("span",[t._v(" 正在重连... ")]):t._e(),t._v(" "),"close"===this.extensionStatus?i("span",[t._v("\n          (未就绪) "),i("a",{staticClass:"el-button--primary el-button--mini el-button",attrs:{href:"Oneyun-SipClient://",size:"mini",type:"primary"}},[t._v("启动分机")])]):t._e(),t._v(" "),"offline"===this.extensionStatus?i("span",[t._v("\n          (断线) "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.setAccount}},[t._v("重连")])],1):t._e()]),t._v(" "),i("div",{staticClass:"cb"},[i("span",[t._v("呼叫中心欢迎你: ")]),t._v(" "),i("span",{staticClass:"text-danger"},[i("router-link",{attrs:{to:{name:"userInfo"}}},[t._v(" "+t._s(this.origin.user.name)+" ")])],1),t._v(" "),i("el-select",{directives:[{name:"model",rawName:"v-model",value:t.status,expression:"status"}],attrs:{size:"mini",placeholder:"请选择"},domProps:{value:t.status},on:{change:t.changeUserStatus,input:function(e){t.status=e}}},t._l(t.statusList,function(e){return i("el-option",{attrs:{label:e.label,value:e.value}},[i("span",{staticClass:"user-zuoxi-status",staticStyle:{float:"left"}},[i("svg",[i("use",{attrs:{"xlink:href":"#"+e.icon}})])]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.label))])])})),t._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.logout}},[t._v("退出")])],1)])])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"website-logo"}},[n("div",{staticClass:"flex center fill"},[n("img",{attrs:{src:i(187),alt:""}})])])}]}},203:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"admin"}},[i("navigation"),t._v(" "),i("sidebar"),t._v(" "),i("div",{attrs:{id:"main"}},[i("router-view")],1)],1)},staticRenderFns:[]}},205:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icons",attrs:{id:"aside"}},[i("ul",[i("li",[i("router-link",{attrs:{to:"/admin/current"}},[i("div",{staticClass:"aside-link-wrap flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#current-phone"}})])]),t._v(" "),i("div",[t._v(" 当前通话 ")])])])],1),t._v(" "),i("li",[i("router-link",{attrs:{to:"/admin/customer"}},[i("div",{staticClass:"aside-link-wrap flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#kehu"}})])]),t._v(" "),i("div",[t._v(" 客户 ")])])])],1),t._v(" "),i("li",[i("router-link",{attrs:{to:"/admin/banquet"}},[i("div",{staticClass:"aside-link-wrap flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#zuoxi"}})])]),t._v(" "),i("div",[t._v(" 坐席 ")])])])],1),t._v(" "),i("li",[i("router-link",{attrs:{to:"/admin/statistics"}},[i("div",{staticClass:"aside-link-wrap flex center direction-column"},[i("div",[i("svg",[i("use",{attrs:{"xlink:href":"#tongji"}})])]),t._v(" "),i("div",[t._v(" 统计查询 ")])])])],1)])])},staticRenderFns:[]}},215:function(t,e,i){var n=i(173);"string"==typeof n&&(n=[[t.i,n,""]]);i(38)(n,{});n.locals&&(t.exports=n.locals)},219:function(t,e,i){var n=i(177);"string"==typeof n&&(n=[[t.i,n,""]]);i(38)(n,{});n.locals&&(t.exports=n.locals)},220:function(t,e,i){var n=i(178);"string"==typeof n&&(n=[[t.i,n,""]]);i(38)(n,{});n.locals&&(t.exports=n.locals)}});